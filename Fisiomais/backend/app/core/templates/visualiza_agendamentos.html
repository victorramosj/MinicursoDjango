{% extends "base.html" %}

{% block content %}
<div class="container my-4">
    <div class="card shadow">
        <div class="card-header text-center text-primary fw-bold">
            <h2>Visualizar Agendamentos</h2>
        </div>

        <div class="card-body">
            <form method="get" class="row mb-4">
                <div class="col-md-3">
                    <select class="form-select" name="pesquisa_tipo">
                        <option value="agendamento" {% if pesquisa_tipo == 'agendamento' %}selected{% endif %}>Nº do Agendamento</option>
                        <option value="cliente" {% if pesquisa_tipo == 'cliente' %}selected{% endif %}>Cliente</option>
                        <option value="colaborador" {% if pesquisa_tipo == 'colaborador' %}selected{% endif %}>Colaborador</option>
                        <option value="clinica" {% if pesquisa_tipo == 'clinica' %}selected{% endif %}>Clínica</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control" name="pesquisa_valor" value="{{ pesquisa_valor }}" placeholder="Pesquisar...">
                </div>
                <div class="col-md-3">
                    <button type="submit" class="btn btn-primary w-100">Pesquisar</button>
                </div>
            </form>

            <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Cliente</th>
                        <th>
                            Data
                            <a href="?sort_key=data_e_hora&direction=asc">↑</a>
                            <a href="?sort_key=data_e_hora&direction=desc">↓</a>
                        </th>
                        <th>Hora</th>
                        <th>Serviço</th>
                        <th>Valor (R$)</th>
                        <th>Colaborador</th>
                        <th>Status</th>
                        <th>Detalhes</th>
                    </tr>
                </thead>
                <tbody>
                    {% for agendamento in page_obj %}
                    <tr>
                        <td>{{ agendamento.id }}</td>
                        <td>{{ agendamento.cliente.nome }}</td>
                        <td>{{ agendamento.data_e_hora|date:"d/m/Y" }}</td>
                        <td>{{ agendamento.data_e_hora|time:"H:i" }}</td>
                        <td>{{ agendamento.servico.nome_servico }}</td>
                        <td>{{ agendamento.plano.valor|default:agendamento.servico.valor }}</td>
                        <td>{{ agendamento.colaborador.nome }}</td>
                        <td>{{ agendamento.status }}</td>
                        <td>
                            <a href="{% url 'detalhes_agendamento' agendamento.id %}" class="btn btn-info btn-sm">Ver</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <nav>
                <ul class="pagination justify-content-center">
                    {% for page_num in page_obj.paginator.page_range %}
                        <li class="page-item {% if page_obj.number == page_num %}active{% endif %}">
                            <a class="page-link" href="?page={{ page_num }}">{{ page_num }}</a>
                        </li>
                    {% endfor %}
                </ul>
            </nav>
        </div>
    </div>
</div>
{% endblock %}
